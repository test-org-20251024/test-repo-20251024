<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Crine - ãƒã‚°å ±å‘Š</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .container {
            max-width: 600px;
            width: 100%;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            margin-bottom: 10px;
        }

        .header p {
            font-size: 14px;
            opacity: 0.95;
        }

        .content {
            padding: 40px;
        }

        .info-box {
            background: #e3f2fd;
            border-left: 5px solid #2196f3;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 30px;
        }

        .info-box h3 {
            color: #1976d2;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .info-box p {
            color: #555;
            line-height: 1.6;
            font-size: 14px;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            font-weight: 600;
            color: #2d3436;
            margin-bottom: 10px;
            font-size: 15px;
        }

        .form-group label .required {
            color: #e74c3c;
            margin-left: 5px;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 14px 18px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 16px;
            font-family: inherit;
            transition: all 0.3s ease;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e74c3c;
            box-shadow: 0 0 0 3px rgba(231, 76, 60, 0.1);
        }

        .form-group textarea {
            min-height: 120px;
            resize: vertical;
        }

        .button-group {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
            margin-top: 30px;
        }

        .btn {
            padding: 18px 25px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.2);
        }

        .btn-primary {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .alert {
            padding: 15px 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-weight: 600;
            display: none;
        }

        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 2px solid #f5c6cb;
        }

        .system-info {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
            font-size: 12px;
            color: #666;
            margin-top: 20px;
        }

        .system-info div {
            padding: 3px 0;
        }

        @media (max-width: 768px) {
            .button-group {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ› ãƒã‚°å ±å‘Š</h1>
            <p>Crine - ã‚·ã‚¹ãƒ†ãƒ æ”¹å–„ã«ã”å”åŠ›ãã ã•ã„</p>
        </div>

        <div class="content">
            <div class="alert alert-error" id="alertError"></div>

            <div class="info-box">
                <h3>ğŸ“§ Gmail ã§ç°¡å˜å ±å‘Š</h3>
                <p>
                    ä¸‹è¨˜ã®ãƒ•ã‚©ãƒ¼ãƒ ã«å…¥åŠ›ã—ã¦ã€Œãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã™ã¨ã€ã‚ãªãŸã®GmailãŒé–‹ãã¾ã™ã€‚
                    å†…å®¹ã‚’ç¢ºèªã—ã¦ã€Œé€ä¿¡ã€ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚
                </p>
            </div>

            <form id="bugReportForm">
                <div class="form-group">
                    <label>
                        ãŠåå‰
                        <span class="required">*</span>
                    </label>
                    <input type="text" id="reporterName" placeholder="å±±ç”° å¤ªéƒ" required>
                </div>

                <div class="form-group">
                    <label>
                        ã©ã“ã§ãƒã‚°ãŒç™ºç”Ÿã—ã¾ã—ãŸã‹ï¼Ÿ
                        <span class="required">*</span>
                    </label>
                    <select id="bugLocation" required>
                        <option value="">é¸æŠã—ã¦ãã ã•ã„</option>
                        <option value="ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ç”»é¢">ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ç”»é¢</option>
                        <option value="ãƒ¡ã‚¤ãƒ³ã‚«ãƒ«ãƒ†ç”»é¢">ãƒ¡ã‚¤ãƒ³ã‚«ãƒ«ãƒ†ç”»é¢</option>
                        <option value="æç”»ã‚¢ãƒ—ãƒªç”»é¢">æç”»ã‚¢ãƒ—ãƒªç”»é¢</option>
                        <option value="ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”»é¢">ãƒ‡ãƒ¼ã‚¿ä¿å­˜ç”»é¢</option>
                        <option value="ãã®ä»–">ãã®ä»–</option>
                    </select>
                </div>

                <div class="form-group">
                    <label>
                        ãƒã‚°ã®å†…å®¹
                        <span class="required">*</span>
                    </label>
                    <textarea id="bugDescription" placeholder="ä¾‹ï¼š&#10;1. ãƒ¡ã‚¤ãƒ³ã‚«ãƒ«ãƒ†ã§é¡§å®¢æƒ…å ±ã‚’å…¥åŠ›&#10;2. ä¿å­˜ãƒœã‚¿ãƒ³ã‚’ã‚¯ãƒªãƒƒã‚¯&#10;3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹" required></textarea>
                </div>

                <div class="system-info">
                    <strong>ğŸ“± ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±ï¼ˆè‡ªå‹•å–å¾—ï¼‰</strong>
                    <div>ãƒ–ãƒ©ã‚¦ã‚¶: <span id="browserInfo"></span></div>
                    <div>OS: <span id="osInfo"></span></div>
                    <div>ç”»é¢: <span id="screenInfo"></span></div>
                    <div>æ—¥æ™‚: <span id="dateInfo"></span></div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn btn-primary">
                        ğŸ“§ ãƒ¡ãƒ¼ãƒ«ã§é€ä¿¡
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="window.location.href='index.html'">
                        â† æˆ»ã‚‹
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // ===============================================
        // ãƒ©ã‚¤ã‚»ãƒ³ã‚¹èªè¨¼ãƒã‚§ãƒƒã‚¯
        // ===============================================
        function checkAuth() {
            const authInfo = localStorage.getItem('salonLicense');
            
            if (!authInfo) {
                alert('ãƒ¡ã‚¤ãƒ³ã‚¢ãƒ—ãƒªã‹ã‚‰èµ·å‹•ã—ã¦ãã ã•ã„');
                window.location.href = 'index.html';
                return false;
            }
            
            try {
                const auth = JSON.parse(authInfo);
                
                if (new Date(auth.validUntil) < new Date()) {
                    alert('ãƒ©ã‚¤ã‚»ãƒ³ã‚¹ã®æœ‰åŠ¹æœŸé™ãŒåˆ‡ã‚Œã¦ã„ã¾ã™');
                    localStorage.removeItem('salonLicense');
                    window.location.href = 'license.html';
                    return false;
                }
                
                return true;
            } catch (e) {
                console.error('èªè¨¼ã‚¨ãƒ©ãƒ¼:', e);
                localStorage.removeItem('salonLicense');
                window.location.href = 'license.html';
                return false;
            }
        }

        // ===============================================
        // ãƒã‚°å ±å‘Šã‚·ã‚¹ãƒ†ãƒ 
        // ===============================================
        window.addEventListener('DOMContentLoaded', function() {
            if (!checkAuth()) {
                return;
            }
            
            initSystemInfo();
            setupForm();
        });

        function initSystemInfo() {
            // ãƒ–ãƒ©ã‚¦ã‚¶æƒ…å ±
            const ua = navigator.userAgent;
            let browser = 'Unknown';
            if (ua.indexOf('Chrome') > -1) browser = 'Chrome';
            else if (ua.indexOf('Safari') > -1) browser = 'Safari';
            else if (ua.indexOf('Firefox') > -1) browser = 'Firefox';
            else if (ua.indexOf('Edge') > -1) browser = 'Edge';
            
            document.getElementById('browserInfo').textContent = browser;
            
            // OSæƒ…å ±
            let os = 'Unknown';
            if (ua.indexOf('Win') > -1) os = 'Windows';
            else if (ua.indexOf('Mac') > -1) os = 'macOS';
            else if (ua.indexOf('Linux') > -1) os = 'Linux';
            else if (ua.indexOf('Android') > -1) os = 'Android';
            else if (ua.indexOf('iOS') > -1 || ua.indexOf('iPhone') > -1 || ua.indexOf('iPad') > -1) os = 'iOS';
            
            document.getElementById('osInfo').textContent = os;
            
            // ç”»é¢ã‚µã‚¤ã‚º
            document.getElementById('screenInfo').textContent = window.screen.width + ' Ã— ' + window.screen.height;
            
            // æ—¥æ™‚
            document.getElementById('dateInfo').textContent = new Date().toLocaleString('ja-JP');
        }

        function setupForm() {
            document.getElementById('bugReportForm').addEventListener('submit', function(e) {
                e.preventDefault();
                
                // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
                const reporterName = document.getElementById('reporterName').value.trim();
                const bugLocation = document.getElementById('bugLocation').value;
                const bugDescription = document.getElementById('bugDescription').value.trim();
                
                if (!reporterName || !bugLocation || !bugDescription) {
                    showAlert('å¿…é ˆé …ç›®ã‚’ã™ã¹ã¦å…¥åŠ›ã—ã¦ãã ã•ã„');
                    return;
                }
                
                // ãƒ¡ãƒ¼ãƒ«æœ¬æ–‡ã‚’ä½œæˆ
                const subject = encodeURIComponent('ã€Crineã€‘ãƒã‚°å ±å‘Š');
                
                const body = encodeURIComponent(`
ã€ãƒã‚°å ±å‘Šã€‘

â–  å ±å‘Šè€…: ${reporterName}

â–  ç™ºç”Ÿå ´æ‰€: ${bugLocation}

â–  ãƒã‚°ã®å†…å®¹:
${bugDescription}

â–  ã‚·ã‚¹ãƒ†ãƒ æƒ…å ±:
ãƒ–ãƒ©ã‚¦ã‚¶: ${document.getElementById('browserInfo').textContent}
OS: ${document.getElementById('osInfo').textContent}
ç”»é¢ã‚µã‚¤ã‚º: ${document.getElementById('screenInfo').textContent}
å ±å‘Šæ—¥æ™‚: ${document.getElementById('dateInfo').textContent}

User Agent: ${navigator.userAgent}

---
â€» ã“ã®ãƒ¡ãƒ¼ãƒ«ã¯Crineã®ãƒã‚°å ±å‘Šã‚·ã‚¹ãƒ†ãƒ ã‹ã‚‰é€ä¿¡ã•ã‚Œã¾ã—ãŸ
                `.trim());
                
                // ã‚ãªãŸã®ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                const yourEmail = 'capilus.official@gmail.com';
                
                // mailto: ãƒªãƒ³ã‚¯ã‚’ä½œæˆ
                const mailtoLink = `mailto:${yourEmail}?subject=${subject}&body=${body}`;
                
                // ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ—ãƒªã‚’é–‹ã
                window.location.href = mailtoLink;
                
                // é€ä¿¡å¾Œã€å±¥æ­´ã«ä¿å­˜
                saveToHistory({
                    reporterName,
                    bugLocation,
                    bugDescription,
                    date: new Date().toISOString()
                });
                
                // 3ç§’å¾Œã«ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢
                setTimeout(() => {
                    if (confirm('ãƒã‚°å ±å‘Šã®ãƒ¡ãƒ¼ãƒ«ã‚’é€ä¿¡ã—ã¾ã—ãŸã‹ï¼Ÿ\n\né€ä¿¡ã—ãŸå ´åˆã¯ã€ŒOKã€ã‚’æŠ¼ã—ã¦ãã ã•ã„ã€‚ãƒ•ã‚©ãƒ¼ãƒ ãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã™ã€‚')) {
                        document.getElementById('bugReportForm').reset();
                        alert('ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸï¼');
                    }
                }, 3000);
            });
        }

        function saveToHistory(report) {
            const history = JSON.parse(localStorage.getItem('bugReportHistory') || '[]');
            history.unshift(report);
            
            if (history.length > 20) {
                history.splice(20);
            }
            
            localStorage.setItem('bugReportHistory', JSON.stringify(history));
        }

        function showAlert(message) {
            const alertElement = document.getElementById('alertError');
            alertElement.textContent = message;
            alertElement.style.display = 'block';
            
            setTimeout(() => {
                alertElement.style.display = 'none';
            }, 5000);
        }
    </script>
</body>
</html>
